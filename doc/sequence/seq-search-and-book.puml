@startuml seq-search-and-book
title Search Route → Pick Schedule → Create Booking
autonumber

actor User as U
participant "Gateway" as GW
participant "ms_route" as MSR
participant "ms_booking" as MSB
participant "ms_user" as MSU
database "MySQL (route)" as DB_R
database "MySQL (booking)" as DB_B

== Search routes ==
U -> GW: GET /api/routes?origin=HCM&dest=Hanoi
GW -> MSR: GET /routes?origin=HCM&dest=Hanoi
MSR -> DB_R: SELECT routes
DB_R --> MSR: routes[]
MSR --> GW: 200 routes[]
GW --> U: routes[]

== Get schedules for a route ==
U -> GW: GET /api/routes/{routeId}/schedules?date=2025-09-20
GW -> MSR: GET /routes/{id}/schedules?date=...
MSR -> DB_R: SELECT schedules by route_id + date
DB_R --> MSR: schedules[]
MSR --> GW: 200 schedules[]
GW --> U: schedules[]

== Create booking (UUID references) ==
U -> GW: POST /api/bookings {userId, scheduleId, seats...}
GW -> MSU: GET /users/{userId}
MSU --> GW: 200 (exists)
GW -> MSB: POST /bookings {...}
MSB -> DB_B: INSERT booking (status=PENDING)
DB_B --> MSB: bookingId
MSB --> GW: 201 booking (PENDING)
GW --> U: 201 booking (PENDING) + bookingReference
@enduml
